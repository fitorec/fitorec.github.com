<!DOCTYPE html>
<!--
  Copyright 2010 Google Inc.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.

  Original slides: Marcin Wichary (mwichary@google.com)
  Modifications: Ernest Delgado (ernestd@google.com)
                 Alex Russell (slightlyoff@chromium.org)

  landslide modifications: Adam Zapletal (adamzap@gmail.com)
                           Nicolas Perriault (nperriault@gmail.com)
-->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title><del>Tiggers</del> Triggers en SQL</title>
    <!-- Styles -->

    <link rel="stylesheet" media="print" href="../../presentacion/css/print.css">
    <link rel="stylesheet" media="screen, projection" href="../../presentacion/css/screen.css">


    <!-- /Styles -->
    <!-- Javascripts -->

    <script type="text/javascript" src="../../presentacion/js/slides.js"></script>



    <!-- /Javascripts -->
</head>
<body>
  <div id="blank"></div>
  <div class="presentation">
    <div id="current_presenter_notes">
      <div id="presenter_note"></div>
    </div>
    <div class="slides">

      <!-- slide source: disparadores.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">

            <header><h1><del>Tiggers</del> Triggers en SQL</h1></header>


            <section><p><br><br>
<center>
<img alt="Tigger" src="img/tigger.gif" />
</center></p></section>

          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>

            </section>
          </div>
          <footer>

            <aside class="source">
              Source: <a href="disparadores.md">disparadores.md</a>
            </aside>

            <aside class="page_number">
              1/14
            </aside>
          </footer>
        </div>
      </div>

      <!-- slide source: disparadores.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">

            <header><h1>Disparadores :</h1></header>


            <section><p>Un <strong><em>trigger</em></strong> (o disparador) en una Base de datos, es un procedimiento que se ejecuta cuando se cumple una condición establecida al realizar una operación. en <strong>MySQL</strong> los <strong>triggers</strong> pueden procesar eventos en determinados momentos:</p>
<p><img alt="Disparadores" src="img/disparadores.png" /></p></section>

          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>

            </section>
          </div>
          <footer>

            <aside class="source">
              Source: <a href="disparadores.md">disparadores.md</a>
            </aside>

            <aside class="page_number">
              2/14
            </aside>
          </footer>
        </div>
      </div>

      <!-- slide source: disparadores.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">

            <header><h1>Eventos y momentos</h1></header>


            <section><p>A continuación mostramos la lista de eventos que podemos disparar en determinado momento:</p>
<h2>Eventos disponibles en Triggers:</h2>
<ul>
<li><strong>Inserción</strong> (<code>INSERT</code>)</li>
<li><strong>Actualización</strong> (<code>UPDATE</code>)</li>
<li><strong>Borrado</strong> (<code>DELETE</code>)</li>
</ul>
<p>A su vez podemos procesar estos eventos en dos momentos:</p>
<h2>Momentos disponibles para los Eventos:</h2>
<ul>
<li><strong>Antes</strong> <code>BEFORE</code></li>
<li><strong>Después</strong> <code>AFTER</code></li>
</ul>
<p>En otras palabras podemos atrapar <strong>3 eventos</strong> en <strong>2 momentos</strong> por cada tabla en nuestra base de datos.</p></section>

          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>

            </section>
          </div>
          <footer>

            <aside class="source">
              Source: <a href="disparadores.md">disparadores.md</a>
            </aside>

            <aside class="page_number">
              3/14
            </aside>
          </footer>
        </div>
      </div>

      <!-- slide source: disparadores.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">

            <header><h1>Sintaxis Básica:</h1></header>


            <section><div class="highlight"><pre><span class="lineno">1</span> <span class="k">CREATE</span> <span class="k">TRIGGER</span> <span class="n">nombre_disp</span>
<span class="lineno">2</span>     <span class="n">momento_disp</span> <span class="n">evento_disp</span> <span class="k">ON</span> <span class="n">nombre_tabla</span>
<span class="lineno">3</span>     <span class="k">FOR</span> <span class="k">EACH</span> <span class="k">ROW</span> <span class="n">sentencia_disp</span><span class="p">;</span>
</pre></div>

<p>El disparador queda asociado a la tabla <strong>nombre_tabl</strong>a. Esta debe ser una tabla permanente, no puede ser una tabla <em>TEMPORARY</em> ni una vista.</p>
<p><strong>momento_disp</strong> es el momento en que el disparador entra en acción. Puede ser <strong>BEFORE</strong> (antes) o <strong>AFTER</strong> (después), para indicar que el disparador se ejecute antes o después que la sentencia que lo activa.</p>
<p><strong>sentencia_disp</strong> es la sentencia que se ejecuta cuando se activa el disparador.</p>
<h2>Borrar un disparador</h2>
<div class="highlight"><pre><span class="lineno">1</span> <span class="k">DROP</span> <span class="k">TRIGGER</span> <span class="n">nombre_disp</span><span class="p">;</span>
</pre></div>

<blockquote>
<p>La sentencia <strong>DROP TRIGGER</strong> necesita que se posea el privilegio <strong>SUPER</strong>.</p>
</blockquote>
<h2>Viendo las disparadores existentes:</h2>
<div class="highlight"><pre><span class="lineno">1</span> <span class="k">SHOW</span> <span class="n">TRIGGERS</span><span class="p">;</span>
</pre></div>
</section>

          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>

            </section>
          </div>
          <footer>

            <aside class="source">
              Source: <a href="disparadores.md">disparadores.md</a>
            </aside>

            <aside class="page_number">
              4/14
            </aside>
          </footer>
        </div>
      </div>

      <!-- slide source: disparadores.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">

            <header><h2>Restricciones En Disparadores:</h2></header>


            <section><p>Si se desean ejecutar múltiples sentencias, deben colocarse entre <strong>BEGIN ... END</strong>, el constructor de sentencias compuestas.</p>
<p>Para esto es necesario modifcar el delimitador de fin de instrucción (<code>DELIMITER</code>) y al final restaurar por el delimitador por defecto <code>;</code>.</p>
<h2>Ejemplo disparador con multiples instrucciones:</h2>
<div class="highlight"><pre><span class="lineno">1</span> <span class="k">DELIMITER</span> <span class="o">|</span>
<span class="lineno">2</span> <span class="k">CREATE</span> <span class="k">TRIGGER</span> <span class="n">testref</span> <span class="k">BEFORE</span> <span class="k">INSERT</span> <span class="k">ON</span> <span class="n">test1</span>
<span class="lineno">3</span>   <span class="k">FOR</span> <span class="k">EACH</span> <span class="k">ROW</span> <span class="k">BEGIN</span>
<span class="lineno">4</span>     <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">test2</span> <span class="k">SET</span> <span class="n">a2</span> <span class="o">=</span> <span class="k">NEW</span><span class="p">.</span><span class="n">a1</span><span class="p">;</span>
<span class="lineno">5</span>     <span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">test3</span> <span class="k">WHERE</span> <span class="n">a3</span> <span class="o">=</span> <span class="k">NEW</span><span class="p">.</span><span class="n">a1</span><span class="p">;</span>
<span class="lineno">6</span>     <span class="k">UPDATE</span> <span class="n">test4</span> <span class="k">SET</span> <span class="n">b4</span> <span class="o">=</span> <span class="n">b4</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">WHERE</span> <span class="n">a4</span> <span class="o">=</span> <span class="k">NEW</span><span class="p">.</span><span class="n">a1</span><span class="p">;</span>
<span class="lineno">7</span>   <span class="k">END</span>
<span class="lineno">8</span> <span class="o">|</span>
<span class="lineno">9</span> <span class="k">DELIMITER</span> <span class="p">;</span>
</pre></div>

<p>No puede haber dos disparadores en una misma tabla que correspondan al mismo momento y sentencia. Por ejemplo, no se pueden tener dos disparadores <strong>BEFORE UPDATE</strong>. Pero sí es posible tener los disparadores <strong>BEFORE UPDATE</strong> y <strong>BEFORE INSERT</strong> o <strong>BEFORE UPDATE</strong> y <strong>AFTER UPDATE</strong>.</p></section>

          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>

            </section>
          </div>
          <footer>

            <aside class="source">
              Source: <a href="disparadores.md">disparadores.md</a>
            </aside>

            <aside class="page_number">
              5/14
            </aside>
          </footer>
        </div>
      </div>

      <!-- slide source: disparadores.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">

            <header><h1>Ejemplo completo:</h1></header>


            <section><p>Vamos a crear una base de datos con el nombre <code>prueba_triggers</code>, y nos seleccionamos para usar dicha base de datos, como se muestra a continuación:</p>
<div class="highlight"><pre><span class="lineno">1</span> <span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="n">prueba_triggers</span><span class="p">;</span>
<span class="lineno">2</span> <span class="n">USE</span> <span class="n">prueba_triggers</span><span class="p">;</span>
</pre></div>
</section>

          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>

            </section>
          </div>
          <footer>

            <aside class="source">
              Source: <a href="disparadores.md">disparadores.md</a>
            </aside>

            <aside class="page_number">
              6/14
            </aside>
          </footer>
        </div>
      </div>

      <!-- slide source: disparadores.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">

            <header><h1>Creando tablas:</h1></header>


            <section><p>Posteriormente creamos dos tablas: alumnos y logs, donde en alumnos vamos a agregar un conjunto de disparadores que van a guardar registros en la tabla logs:</p>
<div class="highlight"><pre><span class="lineno"> 1</span> <span class="c1">-- Borramos(si existe) y Creamos tabla alumnos</span>
<span class="lineno"> 2</span> <span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">alumnos</span><span class="p">;</span>
<span class="lineno"> 3</span> <span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">alumnos</span><span class="p">(</span>
<span class="lineno"> 4</span>     <span class="n">id</span> <span class="nb">INT</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="lineno"> 5</span>         <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="k">NOT</span>
<span class="lineno"> 6</span>         <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
<span class="lineno"> 7</span>     <span class="n">equipo</span> <span class="nb">INT</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
<span class="lineno"> 8</span>     <span class="n">nombre</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">150</span><span class="p">),</span>
<span class="lineno"> 9</span>     <span class="n">fecha_registro</span> <span class="n">DATETIME</span>
<span class="lineno">10</span> <span class="p">);</span>
<span class="lineno">11</span>
<span class="lineno">12</span> <span class="c1">-- Borramos(si existe) y creamos la tabla logs para guardar</span>
<span class="lineno">13</span> <span class="c1">-- los eventos de la tabla</span>
<span class="lineno">14</span> <span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">logs</span><span class="p">;</span>
<span class="lineno">15</span> <span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">logs</span><span class="p">(</span>
<span class="lineno">16</span>     <span class="n">id</span> <span class="nb">INT</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="lineno">17</span>         <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="lineno">18</span>         <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
<span class="lineno">19</span>     <span class="n">msg</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
<span class="lineno">20</span> <span class="p">);</span>
</pre></div>
</section>

          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>

            </section>
          </div>
          <footer>

            <aside class="source">
              Source: <a href="disparadores.md">disparadores.md</a>
            </aside>

            <aside class="page_number">
              7/14
            </aside>
          </footer>
        </div>
      </div>

      <!-- slide source: disparadores.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">

            <header><h2>Disparador <code>BEFORE INSERT</code></h2></header>


            <section><h2>Ejemplo agregando un disparados sobre la tabla alumnos</h2>
<p>Vamos a crear un disparador que se va a encargar en generar la <strong>fecha de registro</strong> al agregar(insert) un nuevo alumno, ademas agregamos un registro en la tabla logs indicando que se va a guardar un determinado alumno:</p>
<div class="highlight"><pre><span class="lineno"> 1</span> <span class="c1">-- Borramos el disparador si es que existe</span>
<span class="lineno"> 2</span> <span class="k">DROP</span> <span class="k">TRIGGER</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">auto_gen_fecha_reg</span><span class="p">;</span>
<span class="lineno"> 3</span> <span class="c1">-- Cambiamos el delimitador</span>
<span class="lineno"> 4</span> <span class="k">delimiter</span> <span class="o">//</span>
<span class="lineno"> 5</span> <span class="k">CREATE</span> <span class="k">TRIGGER</span> <span class="n">auto_gen_fecha_reg</span>
<span class="lineno"> 6</span>     <span class="k">BEFORE</span> <span class="k">INSERT</span> <span class="k">ON</span> <span class="n">alumnos</span>
<span class="lineno"> 7</span>      <span class="k">FOR</span> <span class="k">EACH</span> <span class="k">ROW</span>
<span class="lineno"> 8</span>       <span class="k">BEGIN</span>
<span class="lineno"> 9</span>         <span class="k">SET</span> <span class="k">NEW</span><span class="p">.</span><span class="n">fecha_registro</span> <span class="o">=</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">NOW</span><span class="p">());</span>
<span class="lineno">10</span>         <span class="k">SET</span> <span class="k">NEW</span><span class="p">.</span><span class="n">equipo</span> <span class="o">=</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">ROUND</span><span class="p">(</span><span class="n">RAND</span><span class="p">()</span><span class="o">*</span><span class="mi">3</span><span class="p">));</span>
<span class="lineno">11</span>         <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">logs</span> <span class="k">VALUES</span><span class="p">(</span>
<span class="lineno">12</span>             <span class="k">NULL</span><span class="p">,</span>
<span class="lineno">13</span>             <span class="n">CONCAT</span><span class="p">(</span><span class="s1">&#39;Previo a guardar alumno: &#39;</span><span class="p">,</span> <span class="k">NEW</span><span class="p">.</span><span class="n">nombre</span><span class="p">)</span>
<span class="lineno">14</span>         <span class="p">);</span>
<span class="lineno">15</span>       <span class="k">END</span><span class="p">;</span><span class="o">//</span>
<span class="lineno">16</span> <span class="k">delimiter</span> <span class="p">;</span>
</pre></div>
</section>

          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>

            </section>
          </div>
          <footer>

            <aside class="source">
              Source: <a href="disparadores.md">disparadores.md</a>
            </aside>

            <aside class="page_number">
              8/14
            </aside>
          </footer>
        </div>
      </div>

      <!-- slide source: disparadores.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">

            <header><h2>Disparador <code>AFTER INSERT</code></h2></header>


            <section><p>Vamos a crear un disparador que se va a encargar agregar un registro en la tabla logs indicando que se guardo un determinado alumno:</p>
<div class="highlight"><pre><span class="lineno"> 1</span> <span class="c1">-- Borramos el disparador si es que existe</span>
<span class="lineno"> 2</span> <span class="k">DROP</span> <span class="k">TRIGGER</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">despues_de_add_user</span><span class="p">;</span>
<span class="lineno"> 3</span> <span class="c1">-- Cambiamos el delimitador</span>
<span class="lineno"> 4</span> <span class="k">delimiter</span> <span class="o">//</span>
<span class="lineno"> 5</span> <span class="k">CREATE</span> <span class="k">TRIGGER</span> <span class="n">despues_de_add_user</span>
<span class="lineno"> 6</span>     <span class="k">AFTER</span> <span class="k">INSERT</span> <span class="k">ON</span> <span class="n">alumnos</span>
<span class="lineno"> 7</span>     <span class="k">FOR</span> <span class="k">EACH</span> <span class="k">ROW</span>
<span class="lineno"> 8</span>       <span class="k">BEGIN</span>
<span class="lineno"> 9</span>         <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">logs</span> <span class="k">VALUES</span><span class="p">(</span>
<span class="lineno">10</span>             <span class="k">NULL</span><span class="p">,</span>
<span class="lineno">11</span>             <span class="n">CONCAT</span><span class="p">(</span><span class="s1">&#39;Despues de guardar alumno: &#39;</span><span class="p">,</span> <span class="k">NEW</span><span class="p">.</span><span class="n">nombre</span><span class="p">)</span>
<span class="lineno">12</span>         <span class="p">);</span>
<span class="lineno">13</span>      <span class="k">END</span><span class="p">;</span><span class="o">//</span>
<span class="lineno">14</span> <span class="k">delimiter</span> <span class="p">;</span>
</pre></div>
</section>

          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>

            </section>
          </div>
          <footer>

            <aside class="source">
              Source: <a href="disparadores.md">disparadores.md</a>
            </aside>

            <aside class="page_number">
              9/14
            </aside>
          </footer>
        </div>
      </div>

      <!-- slide source: disparadores.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">

            <header><h2>Disparador <code>AFTER UPDATE</code></h2></header>


            <section><p>De forma análoga podemos agregar los disparadores <code>after update</code> y el <code>after delete</code>, como se muestra a continuación:</p>
<div class="highlight"><pre><span class="lineno"> 1</span> <span class="c1">-- Borramos el disparador si es que existe</span>
<span class="lineno"> 2</span> <span class="k">DROP</span> <span class="k">TRIGGER</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">despues_de_edit_user</span><span class="p">;</span>
<span class="lineno"> 3</span>
<span class="lineno"> 4</span> <span class="c1">-- Cambiamos el delimitador</span>
<span class="lineno"> 5</span> <span class="k">delimiter</span> <span class="o">//</span>
<span class="lineno"> 6</span> <span class="k">CREATE</span> <span class="k">TRIGGER</span> <span class="n">despues_de_edit_user</span>
<span class="lineno"> 7</span>     <span class="k">AFTER</span> <span class="k">UPDATE</span> <span class="k">ON</span> <span class="n">alumnos</span>
<span class="lineno"> 8</span>     <span class="k">FOR</span> <span class="k">EACH</span> <span class="k">ROW</span> <span class="k">BEGIN</span>
<span class="lineno"> 9</span>         <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">logs</span> <span class="k">VALUES</span><span class="p">(</span>
<span class="lineno">10</span>         <span class="k">NULL</span><span class="p">,</span>
<span class="lineno">11</span>             <span class="n">CONCAT</span><span class="p">(</span>
<span class="lineno">12</span>                 <span class="s1">&#39;Se modifico el usuario: &#39;</span><span class="p">,</span> <span class="k">OLD</span><span class="p">.</span><span class="n">nombre</span>
<span class="lineno">13</span>                 <span class="p">,</span><span class="s1">&#39; Su nuevo nombre es:&#39;</span><span class="p">,</span> <span class="k">NEW</span><span class="p">.</span><span class="n">nombre</span>
<span class="lineno">14</span>             <span class="p">)</span>
<span class="lineno">15</span>         <span class="p">);</span>
<span class="lineno">16</span>     <span class="k">END</span><span class="p">;</span><span class="o">//</span>
<span class="lineno">17</span> <span class="k">delimiter</span> <span class="p">;</span>
</pre></div>
</section>

          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>

            </section>
          </div>
          <footer>

            <aside class="source">
              Source: <a href="disparadores.md">disparadores.md</a>
            </aside>

            <aside class="page_number">
              10/14
            </aside>
          </footer>
        </div>
      </div>

      <!-- slide source: disparadores.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">

            <header><h2>Disparador <code>AFTER DELETE</code></h2></header>


            <section><div class="highlight"><pre><span class="lineno"> 1</span> <span class="c1">-- Borramos el disparador si es que existe</span>
<span class="lineno"> 2</span> <span class="k">DROP</span> <span class="k">TRIGGER</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">borrando_alumno</span><span class="p">;</span>
<span class="lineno"> 3</span>
<span class="lineno"> 4</span> <span class="c1">-- Cambiamos el delimitador</span>
<span class="lineno"> 5</span> <span class="k">delimiter</span> <span class="o">//</span>
<span class="lineno"> 6</span> <span class="k">CREATE</span> <span class="k">TRIGGER</span> <span class="n">borrando_alumno</span>
<span class="lineno"> 7</span>     <span class="k">AFTER</span> <span class="k">DELETE</span> <span class="k">ON</span> <span class="n">alumnos</span>
<span class="lineno"> 8</span>     <span class="k">FOR</span> <span class="k">EACH</span> <span class="k">ROW</span> <span class="k">BEGIN</span>
<span class="lineno"> 9</span>         <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">logs</span> <span class="k">VALUES</span><span class="p">(</span>
<span class="lineno">10</span>             <span class="k">NULL</span><span class="p">,</span>
<span class="lineno">11</span>             <span class="n">CONCAT</span><span class="p">(</span><span class="s1">&#39;Se a borrado el alumno: &#39;</span><span class="p">,</span> <span class="k">OLD</span><span class="p">.</span><span class="n">nombre</span><span class="p">)</span>
<span class="lineno">12</span>         <span class="p">);</span>
<span class="lineno">13</span>     <span class="k">END</span><span class="p">;</span><span class="o">//</span>
<span class="lineno">14</span> <span class="k">delimiter</span> <span class="p">;</span>
</pre></div>

<p>A continuación veremos a ver algunas otras cosas que podemos hacer con los disparadores.</p></section>

          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>

            </section>
          </div>
          <footer>

            <aside class="source">
              Source: <a href="disparadores.md">disparadores.md</a>
            </aside>

            <aside class="page_number">
              11/14
            </aside>
          </footer>
        </div>
      </div>

      <!-- slide source: disparadores.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">

            <header><h1>Uso de señales en disparadores:</h1></header>


            <section><p>Una señal (<strong>SIGNAL</strong>) es una forma de regresar un "error" al motor de <strong>MySQL</strong>, este error lo podemos manejar por medio de:</p>
<ul>
<li>Un numero de error</li>
<li>Un estado SQL(SQLSTATE)</li>
<li>Y/o un mensaje.</li>
</ul>
<p>Usted puede ocupar el <code>SQLSTATE</code> con el valor <code>'45000'</code> para generar un error genérico, esto resulta muy útil en el momento de querer alterar el comportamiento del motor de MySQL como lo vamos a ver a continuación:</p>
<blockquote>
<p><strong>Nota</strong>: El lector puede abundar mas en el tema: <a href="http://dev.mysql.com/doc/refman/5.5/en/signal.html">http://dev.mysql.com/doc/refman/5.5/en/signal.html</a></p>
</blockquote></section>

          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>

            </section>
          </div>
          <footer>

            <aside class="source">
              Source: <a href="disparadores.md">disparadores.md</a>
            </aside>

            <aside class="page_number">
              12/14
            </aside>
          </footer>
        </div>
      </div>

      <!-- slide source: disparadores.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">

            <header><h2>Ejemplo disparador de validación:</h2></header>


            <section><p>Vamos a agregar un disparador que al modificar un alumno valide que el campo nombre no sea menor a 6 caracteres, en caso contrario vamos a generar un error genérico (<code>SQLSTATE 45000</code>) y vamos a generar un mensaje para informar al cliente o a nuestra aplicación el motivo del error:</p>
<div class="highlight"><pre><span class="lineno"> 1</span> <span class="k">CREATE</span> <span class="k">TRIGGER</span> <span class="n">antes_de_edit_user</span>
<span class="lineno"> 2</span>     <span class="k">AFTER</span> <span class="k">UPDATE</span> <span class="k">ON</span> <span class="n">alumnos</span>
<span class="lineno"> 3</span>     <span class="k">FOR</span> <span class="k">EACH</span> <span class="k">ROW</span>
<span class="lineno"> 4</span>     <span class="k">BEGIN</span>
<span class="lineno"> 5</span>         <span class="k">SET</span> <span class="o">@</span><span class="n">tam_nombre</span> <span class="o">=</span> <span class="k">LENGTH</span><span class="p">(</span><span class="k">NEW</span><span class="p">.</span><span class="n">nombre</span><span class="p">);</span>
<span class="lineno"> 6</span>         <span class="n">IF</span> <span class="o">@</span><span class="n">tam_nombre</span> <span class="o">&lt;</span> <span class="mi">6</span>
<span class="lineno"> 7</span>         <span class="k">THEN</span>
<span class="lineno"> 8</span>             <span class="n">SIGNAL</span> <span class="k">SQLSTATE</span> <span class="s1">&#39;45000&#39;</span><span class="p">;</span>
<span class="lineno"> 9</span>             <span class="k">SET</span> <span class="o">@</span><span class="k">MESSAGE_TEXT</span> <span class="o">=</span> <span class="s1">&#39;El nombre no puede ser menor a 6 caracteres&#39;</span><span class="p">;</span>
<span class="lineno">10</span>         <span class="k">END</span> <span class="n">IF</span><span class="p">;</span>
<span class="lineno">11</span>     <span class="k">END</span>
</pre></div>

<p>De esta forma impedimos que se inserten valores no deseados y/o que no comparten la lógica deseada a la vez que generamos un mecanismo para detectar este tipo de errores para poderlos manejar desde nuestra aplicación en cuestión.</p></section>

          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>

            </section>
          </div>
          <footer>

            <aside class="source">
              Source: <a href="disparadores.md">disparadores.md</a>
            </aside>

            <aside class="page_number">
              13/14
            </aside>
          </footer>
        </div>
      </div>

      <!-- slide source: disparadores.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">

            <header><h2>Recursos :</h2></header>


            <section><ul>
<li><a href="./ejemplo_disparadores.sql">Archivo SQL ejemplo de disparadores</a></li>
<li><a href="http://dev.mysql.com/doc/refman/5.0/es/triggers.html">Sitio oficial Mysql Disparadores</a></li>
</ul></section>

          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>

            </section>
          </div>
          <footer>

            <aside class="source">
              Source: <a href="disparadores.md">disparadores.md</a>
            </aside>

            <aside class="page_number">
              14/14
            </aside>
          </footer>
        </div>
      </div>

    </div>
  </div>

  <div id="toc" class="sidebar hidden">
    <h2>Table of Contents</h2>
    <table>
      <caption>Table of Contents</caption>

      <tr id="toc-row-1">
        <th><a href="#slide1"><del>Tiggers</del> Triggers en SQL</a></th>
        <td><a href="#slide1">1</a></td>
      </tr>


      <tr id="toc-row-2">
        <th><a href="#slide2">Disparadores :</a></th>
        <td><a href="#slide2">2</a></td>
      </tr>


      <tr id="toc-row-3">
        <th><a href="#slide3">Eventos y momentos</a></th>
        <td><a href="#slide3">3</a></td>
      </tr>


      <tr id="toc-row-4">
        <th><a href="#slide4">Sintaxis Básica:</a></th>
        <td><a href="#slide4">4</a></td>
      </tr>


        <tr id="toc-row-5" class="sub">
          <th><a href="#slide5">Restricciones En Disparadores:</a></th>
          <td><a href="#slide5">5</a></td>
        </tr>



      <tr id="toc-row-6">
        <th><a href="#slide6">Ejemplo completo:</a></th>
        <td><a href="#slide6">6</a></td>
      </tr>


      <tr id="toc-row-7">
        <th><a href="#slide7">Creando tablas:</a></th>
        <td><a href="#slide7">7</a></td>
      </tr>


        <tr id="toc-row-8" class="sub">
          <th><a href="#slide8">Disparador <code>BEFORE INSERT</code></a></th>
          <td><a href="#slide8">8</a></td>
        </tr>

        <tr id="toc-row-9" class="sub">
          <th><a href="#slide9">Disparador <code>AFTER INSERT</code></a></th>
          <td><a href="#slide9">9</a></td>
        </tr>

        <tr id="toc-row-10" class="sub">
          <th><a href="#slide10">Disparador <code>AFTER UPDATE</code></a></th>
          <td><a href="#slide10">10</a></td>
        </tr>

        <tr id="toc-row-11" class="sub">
          <th><a href="#slide11">Disparador <code>AFTER DELETE</code></a></th>
          <td><a href="#slide11">11</a></td>
        </tr>



      <tr id="toc-row-12">
        <th><a href="#slide12">Uso de señales en disparadores:</a></th>
        <td><a href="#slide12">12</a></td>
      </tr>


        <tr id="toc-row-13" class="sub">
          <th><a href="#slide13">Ejemplo disparador de validación:</a></th>
          <td><a href="#slide13">13</a></td>
        </tr>

        <tr id="toc-row-14" class="sub">
          <th><a href="#slide14">Recursos :</a></th>
          <td><a href="#slide14">14</a></td>
        </tr>



    </table>
  </div>

  <div id="help" class="sidebar hidden">
    <h2>Help</h2>
    <table>
      <caption>Help</caption>
      <tr>
        <th>Table of Contents</th>
        <td>t</td>
      </tr>
      <tr>
        <th>Exposé</th>
        <td>ESC</td>
      </tr>
      <tr>
        <th>Full screen slides</th>
        <td>e</td>
      </tr>
      <tr>
        <th>Presenter View</th>
        <td>p</td>
      </tr>
      <tr>
        <th>Source Files</th>
        <td>s</td>
      </tr>
      <tr>
        <th>Slide Numbers</th>
        <td>n</td>
      </tr>
      <tr>
        <th>Toggle screen blanking</th>
        <td>b</td>
      </tr>
      <tr>
        <th>Show/hide slide context</th>
        <td>c</td>
      </tr>
      <tr>
        <th>Notes</th>
        <td>2</td>
      </tr>
      <tr>
        <th>Help</th>
        <td>h</td>
      </tr>
    </table>
  </div>
  <script>main()</script>
</body>
</html>